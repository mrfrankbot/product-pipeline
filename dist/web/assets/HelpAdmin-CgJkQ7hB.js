import{r as n,j as e,R as z}from"./vendor-react-DzgxJkbp.js";import{a as H,u as U,b as Q}from"./vendor-query-BeqrpgNA.js";import{f as y}from"./index-DJAOEm-v.js";import{P as T,B as N,T as i,L as F,C as q,$ as G,b as l,h as J,ag as O,a as p,D as V,I as r,c as X,am as Y,ah as Z,e as d,o,ac as ee,W as se,al as ne,E as I,a0 as te}from"./vendor-polaris-o1SQP_xq.js";const $=["all","pending","answered","published","archived"],ae=t=>{switch(t){case"pending":return e.jsx(d,{tone:"warning",children:"Pending"});case"answered":return e.jsx(d,{tone:"info",children:"Answered"});case"published":return e.jsx(d,{tone:"success",children:"Published"});case"archived":return e.jsx(d,{children:"Archived"});default:return e.jsx(d,{children:t})}},ce=()=>{const t=H(),[v,D]=n.useState(0),[x,u]=n.useState(null),[g,S]=n.useState(""),[b,k]=n.useState(""),[j,C]=n.useState(""),c=$[v],{data:P,isLoading:K,error:A}=U({queryKey:["help-questions",c],queryFn:()=>{const s=c==="all"?"":`?status=${c}`;return y.get(`/help/questions${s}`)}}),a=Q({mutationFn:({id:s,...m})=>y.put(`/help/questions/${s}`,m),onSuccess:()=>{t.invalidateQueries({queryKey:["help-questions"]}),t.invalidateQueries({queryKey:["help-faq"]}),u(null)}}),L=Q({mutationFn:s=>y.delete(`/help/questions/${s}`),onSuccess:()=>{t.invalidateQueries({queryKey:["help-questions"]}),t.invalidateQueries({queryKey:["help-faq"]})}}),f=n.useCallback(s=>{if(x===s.id){u(null);return}u(s.id),S(s.answer||""),k(s.category||""),C(s.status)},[x]),R=n.useCallback(s=>{a.mutate({id:s,answer:g,status:j,category:b||void 0,answered_by:"Admin"})},[g,j,b,a]),_=n.useCallback(s=>{s.answer&&a.mutate({id:s.id,status:"published"})},[a]),W=n.useCallback(s=>{a.mutate({id:s.id,status:"archived"})},[a]),M=$.map(s=>({id:s,content:s.charAt(0).toUpperCase()+s.slice(1),accessibilityLabel:`${s} questions`,panelID:`${s}-panel`})),w=P?.data||[];return A?e.jsx(T,{title:"Help Admin",subtitle:"Manage questions and FAQ content",children:e.jsx(N,{tone:"critical",title:"Failed to load questions",children:e.jsx(i,{as:"p",children:A.message})})}):e.jsx(T,{title:"Help Admin",subtitle:"Manage questions and FAQ content",children:e.jsx(F,{children:e.jsx(F.Section,{children:e.jsx(q,{children:e.jsx(G,{tabs:M,selected:v,onSelect:D,children:e.jsx(l,{paddingBlockStart:"400",children:K?e.jsx(J,{lines:8}):w.length===0?e.jsx(O,{heading:"No questions found",image:"",children:e.jsxs(i,{as:"p",children:["No ",c==="all"?"":c," questions yet."]})}):e.jsx(p,{gap:"0",children:w.map((s,m)=>{const B=x===s.id,h=s.question||s.question_text||s.title||"Untitled question";return e.jsxs(z.Fragment,{children:[m>0&&e.jsx(V,{}),e.jsx(l,{padding:"400",children:e.jsxs(p,{gap:"200",children:[e.jsx("div",{onClick:()=>f(s),style:{cursor:"pointer"},role:"button",tabIndex:0,onKeyDown:E=>{(E.key==="Enter"||E.key===" ")&&f(s)},children:e.jsxs(r,{align:"space-between",blockAlign:"center",wrap:!0,children:[e.jsxs(r,{gap:"200",blockAlign:"center",children:[e.jsx(X,{source:B?Y:Z,tone:"subdued"}),e.jsxs(p,{gap:"050",children:[e.jsx(i,{variant:"bodyMd",fontWeight:"semibold",as:"span",children:h.length>80?h.slice(0,80)+"…":h}),e.jsxs(i,{variant:"bodySm",tone:"subdued",as:"span",children:["#",s.id," ·"," ",s.asked_by?`Asked by ${s.asked_by}`:"Anonymous"," ·"," ",new Date(s.created_at).toLocaleDateString()]})]})]}),e.jsxs(r,{gap:"200",blockAlign:"center",children:[s.category&&e.jsx(d,{children:s.category}),ae(s.status)]})]})}),e.jsxs(r,{gap:"200",blockAlign:"center",children:[s.answer&&s.status!=="published"&&e.jsx(o,{size:"slim",icon:ee,onClick:()=>_(s),children:"Publish"}),s.status!=="archived"&&e.jsx(o,{size:"slim",onClick:()=>W(s),children:"Archive"}),e.jsx(o,{size:"slim",tone:"critical",onClick:()=>{confirm(`Delete question #${s.id}?`)&&L.mutate(s.id)},children:"Delete"})]}),e.jsx(se,{open:B,id:`edit-${s.id}`,children:e.jsx(l,{paddingBlockStart:"400",paddingBlockEnd:"200",borderBlockStartWidth:"025",borderColor:"border",children:e.jsxs(ne,{children:[e.jsxs(p,{gap:"100",children:[e.jsx(i,{variant:"headingSm",as:"h3",children:"Full question"}),e.jsx(l,{background:"bg-fill-secondary",borderRadius:"200",padding:"300",children:e.jsx(i,{as:"p",children:h})})]}),e.jsx(I,{label:"Answer",value:g,onChange:S,multiline:4,autoComplete:"off"}),e.jsxs(r,{gap:"400",wrap:!0,children:[e.jsx(l,{minWidth:"200px",children:e.jsx(I,{label:"Category",value:b,onChange:k,placeholder:"e.g. Shipping, Returns",autoComplete:"off"})}),e.jsx(l,{minWidth:"200px",children:e.jsx(te,{label:"Status",options:[{label:"Pending",value:"pending"},{label:"Answered",value:"answered"},{label:"Published",value:"published"},{label:"Archived",value:"archived"}],value:j,onChange:C})})]}),e.jsxs(r,{gap:"200",children:[e.jsx(o,{variant:"primary",onClick:()=>R(s.id),loading:a.isPending,children:"Save"}),e.jsx(o,{onClick:()=>u(null),children:"Cancel"})]})]})})})]})})]},s.id)})})})})})})})})};export{ce as default};
