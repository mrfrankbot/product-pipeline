import{j as e,h as qe,u as Qe,r as o,R as pe}from"./vendor-react-DzgxJkbp.js";import{a as Ke,u as Ae,b as R}from"./vendor-query-BeqrpgNA.js";import{u as He,l as Ve,m as Ye,f as _}from"./index-DJAOEm-v.js";import{P as Le}from"./ProductPhotoEditor-CThSZZWJ.js";import{D as V}from"./DraggablePhotoGrid-DHroujic.js";import{e as u,P as he,b as Y,I as c,x as Te,L as S,C as d,a as t,T as i,B as k,o as x,z,V as X,y as Z,f as J,l as Xe,E as ee,D as L,as as De,at as Ze,U as Je,ak as Me,M as en,Z as nn}from"./vendor-polaris-o1SQP_xq.js";const tn={"condition-like_new_minus":{label:"Like New-",tone:"success"},"condition-like_new":{label:"Like New",tone:"success"},"condition-excellent_plus":{label:"Excellent+",tone:"success"},"condition-excellent":{label:"Excellent",tone:"info"},"condition-excellent_minus":{label:"Excellent-",tone:"info"},"condition-good_plus":{label:"Good+",tone:"attention"},"condition-good":{label:"Good",tone:"attention"},"condition-good_minus":{label:"Good-",tone:"attention"},"condition-poor":{label:"Poor",tone:"warning"},"condition-ugly":{label:"Ugly",tone:"critical"}};function Ne(r){if(!r?.length)return null;for(const l of r){const g=tn[l];if(g)return g}return null}const A=({tags:r})=>{if(!r?.length)return null;const l=Ne(r);return l?e.jsx(u,{tone:l.tone,children:l.label}):null},sn=[{num:1,label:"Review Content"},{num:2,label:"Save to Shopify"},{num:3,label:"List on eBay"}],an=({currentStep:r})=>e.jsx("div",{style:{display:"flex",alignItems:"center",gap:0,padding:"16px 20px",background:"#f6f6f7",borderRadius:"12px",marginBottom:"20px",border:"1px solid #e3e3e3"},children:sn.map((l,g)=>{const p=l.num===r,a=l.num<r;return e.jsxs(pe.Fragment,{children:[g>0&&e.jsx("div",{style:{flex:1,height:"2px",background:a?"#008060":"#e3e3e3",margin:"0 8px"}}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",flexShrink:0},children:[e.jsx("div",{style:{width:"28px",height:"28px",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"13px",fontWeight:700,background:p||a?"#008060":"#d0d0d0",color:p||a?"#fff":"#666",transition:"background 0.2s"},children:a?"âœ“":l.num}),e.jsx("span",{style:{fontSize:"13px",fontWeight:p?700:500,color:p||a?"#008060":"#6d7175"},children:l.label})]})]},l.num)})}),ue=r=>{switch(r){case"pending":return e.jsx(u,{tone:"attention",children:"Pending Review"});case"approved":return e.jsx(u,{tone:"success",children:"Approved"});case"rejected":return e.jsx(u,{tone:"critical",children:"Rejected"});case"partial":return e.jsx(u,{tone:"warning",children:"Partially Approved"});case"listed":return e.jsx(u,{tone:"success",children:"Listed on eBay"});default:return e.jsx(u,{children:r})}},ne=r=>new Date(r*1e3).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"}),xe={NEW:"New",NEW_OTHER:"New - Other",LIKE_NEW:"Like New",USED_EXCELLENT:"Excellent",VERY_GOOD:"Very Good",GOOD:"Good",ACCEPTABLE:"Acceptable",FOR_PARTS_OR_NOT_WORKING:"For Parts / Not Working"},rn=({preview:r})=>{const[l,g]=o.useState(0),p=parseFloat(r.price)||0,a=xe[r.condition]||r.condition;return e.jsxs("div",{style:{border:"1px solid #e5e7eb",borderRadius:"8px",overflow:"hidden",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',background:"#fff"},children:[e.jsxs("div",{style:{background:"linear-gradient(135deg, #e53238 0%, #0064d3 100%)",padding:"8px 16px",display:"flex",alignItems:"center",gap:"8px"},children:[e.jsx("span",{style:{color:"#fff",fontWeight:800,fontSize:"18px",letterSpacing:"-0.5px"},children:"ebay"}),e.jsx("span",{style:{color:"rgba(255,255,255,0.8)",fontSize:"11px"},children:"Preview â€” not live yet"})]}),e.jsxs("div",{style:{padding:"16px"},children:[e.jsx("h2",{style:{fontSize:"16px",fontWeight:700,color:"#111",margin:"0 0 10px 0",lineHeight:"1.3"},children:r.title||"Untitled Product"}),e.jsx("div",{style:{marginBottom:"10px"},children:e.jsxs("span",{style:{display:"inline-block",padding:"2px 8px",background:"#f0f7ff",color:"#0064d3",borderRadius:"4px",fontSize:"11px",fontWeight:600,border:"1px solid #c8e0ff"},children:["Condition: ",a]})}),e.jsxs("div",{style:{display:"flex",gap:"16px",marginBottom:"12px"},children:[e.jsx("div",{style:{flexShrink:0,width:"200px"},children:r.imageUrls.length>0?e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{width:"200px",height:"200px",border:"1px solid #e5e7eb",borderRadius:"4px",overflow:"hidden",background:"#fafafa",marginBottom:"6px"},children:e.jsx("img",{src:r.imageUrls[l],alt:"Product",style:{width:"100%",height:"100%",objectFit:"contain"},onError:j=>{j.target.style.display="none"}})}),e.jsx("div",{style:{display:"flex",gap:"3px",flexWrap:"wrap"},children:r.imageUrls.slice(0,6).map((j,v)=>e.jsx("div",{onClick:()=>g(v),style:{width:"36px",height:"36px",border:`2px solid ${v===l?"#0064d3":"#e5e7eb"}`,borderRadius:"3px",overflow:"hidden",cursor:"pointer",background:"#fafafa"},children:e.jsx("img",{src:j,alt:"",style:{width:"100%",height:"100%",objectFit:"cover"}})},v))})]}):e.jsx("div",{style:{width:"200px",height:"200px",border:"1px dashed #d1d5db",borderRadius:"4px",display:"flex",alignItems:"center",justifyContent:"center",color:"#9ca3af",fontSize:"13px"},children:"No photos"})}),e.jsxs("div",{style:{flex:1},children:[e.jsxs("div",{style:{fontSize:"26px",fontWeight:700,color:"#111",marginBottom:"4px"},children:["US $",p.toFixed(2)]}),e.jsx("div",{style:{fontSize:"11px",color:"#555",marginBottom:"12px"},children:"+ Free shipping Â· Free returns"}),e.jsxs("div",{style:{padding:"10px",background:"#f0f9f0",borderRadius:"6px",border:"1px solid #c3e6cb",marginBottom:"8px"},children:[e.jsx("div",{style:{fontSize:"12px",fontWeight:600,color:"#1a7f37"},children:"Add to cart"}),e.jsx("div",{style:{fontSize:"11px",color:"#555"},children:"Ships from Salt Lake City, UT"})]}),r.conditionDescription&&e.jsxs("div",{style:{fontSize:"11px",color:"#555",fontStyle:"italic"},children:['"',r.conditionDescription,'"']})]})]}),Object.entries(r.aspects).length>0&&e.jsxs(e.Fragment,{children:[e.jsx(L,{}),e.jsxs("div",{style:{marginTop:"10px"},children:[e.jsx("div",{style:{fontSize:"13px",fontWeight:600,color:"#111",marginBottom:"8px"},children:"Item specifics"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"4px 16px"},children:[r.brand&&e.jsxs(pe.Fragment,{children:[e.jsx("div",{style:{fontSize:"12px",color:"#555"},children:"Brand"}),e.jsx("div",{style:{fontSize:"12px",fontWeight:500,color:"#111"},children:r.brand})]},"brand"),Object.entries(r.aspects).slice(0,6).map(([j,v])=>e.jsxs(pe.Fragment,{children:[e.jsx("div",{style:{fontSize:"12px",color:"#555"},children:j}),e.jsx("div",{style:{fontSize:"12px",fontWeight:500,color:"#111"},children:Array.isArray(v)?v.join(", "):String(v)})]},j))]})]})]})]})]})},pn=()=>{const{id:r}=qe(),l=Qe(),g=Ke(),{addNotification:p}=He(),a=parseInt(r||"0"),[j,v]=o.useState(1),[T,ge]=o.useState(""),[C,ie]=o.useState(""),[je,te]=o.useState([]),[fe,ye]=o.useState(!1),[D,U]=o.useState(null),[O,P]=o.useState(null),[G,I]=o.useState(null),[q,se]=o.useState(""),[be,me]=o.useState(!1),[F,ve]=o.useState(!1),[Se,$e]=o.useState(!0),[We,we]=o.useState(null),[f,ke]=o.useState(null),[E,Ce]=o.useState(null),{data:Pe}=Ae({queryKey:["drafts","pending","nav"],queryFn:()=>_.get("/drafts?status=pending&limit=200&offset=0"),staleTime:3e4}),B=o.useMemo(()=>Pe?.data?.map(n=>n.id)||[],[Pe]),M=o.useMemo(()=>B.indexOf(a),[B,a]),N=M>0?B[M-1]:null,y=M>=0&&M<B.length-1?B[M+1]:null,{data:Ie,isLoading:Re}=Ae({queryKey:["draft-detail",a],queryFn:()=>_.get(`/drafts/${a}`),enabled:a>0}),s=Ie?.draft,Q=Ie?.live,ae=s?.shopify_product_id,{data:K}=Ve(ae),ze=Ye();o.useEffect(()=>{if(s&&!fe){ge(s.draft_title||""),ie(s.draft_description||"");const n=(s.draftImages||[]).filter(m=>m&&m.startsWith("http"));te(n),ye(!0)}},[s,fe]),o.useEffect(()=>{ye(!1),v(1),ve(!1),we(null),ke(null),Ce(null),me(!1),se("")},[a]),o.useEffect(()=>{K?.notes!==void 0&&!be&&(se(K.notes),me(!0))},[K,be]),o.useEffect(()=>{const n=m=>{j===1&&(m.key==="ArrowLeft"&&N&&l(`/review/${N}`),m.key==="ArrowRight"&&y&&l(`/review/${y}`))};return window.addEventListener("keydown",n),()=>window.removeEventListener("keydown",n)},[N,y,l,j]),o.useEffect(()=>{if(F&&j===2){const n=setTimeout(()=>v(3),1200);return()=>clearTimeout(n)}},[F,j]);const Ee=R({mutationFn:()=>_.post(`/drafts/${a}/reject`),onSuccess:()=>{g.invalidateQueries({queryKey:["drafts"]}),g.invalidateQueries({queryKey:["drafts-count"]}),p({type:"success",title:"Draft rejected",autoClose:4e3}),y?l(`/review/${y}`,{replace:!0}):l("/review",{replace:!0})},onError:n=>{p({type:"error",title:"Reject failed",message:n instanceof Error?n.message:"Unknown error",autoClose:8e3})}}),re=R({mutationFn:n=>_.put(`/drafts/${a}`,n),onSuccess:()=>{g.invalidateQueries({queryKey:["draft-detail",a]})}}),oe=R({mutationFn:n=>_.put(`/drafts/${a}`,{images:n}),onSuccess:()=>{g.invalidateQueries({queryKey:["draft-detail",a]})},onError:n=>{p({type:"error",title:"Photo save failed",message:n instanceof Error?n.message:"Unknown error",autoClose:6e3})}}),H=R({mutationFn:()=>_.post(`/drafts/${a}/approve`,{photos:!0,description:!0,publish:Se}),onSuccess:n=>{g.invalidateQueries({queryKey:["drafts"]}),g.invalidateQueries({queryKey:["drafts-count"]}),ve(!0),we(n?.published??!1),n?.published===!1&&n?.publishError?p({type:"warning",title:"Saved to Shopify (not published)",message:"Content saved but product was not published. You can publish manually in Shopify.",autoClose:8e3}):p({type:"success",title:"âœ… Saved to Shopify!",message:n?.published?"Content pushed and product published":"Content pushed to Shopify",autoClose:4e3}),$.mutate()},onError:n=>{p({type:"error",title:"Save failed",message:n instanceof Error?n.message:"Unknown error",autoClose:8e3})}}),$=R({mutationFn:()=>_.post(`/drafts/${a}/preview-ebay-listing`),onSuccess:n=>{n.preview&&ke(n.preview)}}),W=R({mutationFn:()=>_.post(`/drafts/${a}/list-on-ebay`,{}),onSuccess:n=>{n.success&&n.listingId?(g.invalidateQueries({queryKey:["draft-detail",a]}),g.invalidateQueries({queryKey:["drafts"]}),Ce({listingId:n.listingId,ebayUrl:n.ebayUrl||`https://www.ebay.com/itm/${n.listingId}`}),p({type:"success",title:"ðŸŽ‰ Listed on eBay!",message:`Listing #${n.listingId}`,autoClose:8e3})):p({type:"error",title:"eBay listing failed",message:n.error||"Unknown error",autoClose:1e4})},onError:n=>{p({type:"error",title:"eBay listing failed",message:n instanceof Error?n.message:"Unknown error",autoClose:1e4})}}),le=o.useCallback(async n=>{te(n),await oe.mutateAsync(n)},[oe]),Ue=o.useCallback(async()=>{const n=[];if(s){const m=T!==(s.draft_title||""),Ge=C!==(s.draft_description||"");(m||Ge)&&n.push(re.mutateAsync({title:T,description:C}))}await Promise.all(n),v(2)},[s,T,C,re]),Fe=o.useCallback(()=>{H.mutate()},[H]);o.useCallback(()=>{v(3),f||$.mutate()},[f,$]);const Oe=o.useCallback(()=>{y?l(`/review/${y}`,{replace:!0}):l("/review",{replace:!0})},[y,l]),_e=o.useCallback(()=>{y?l(`/review/${y}`,{replace:!0}):l("/review",{replace:!0})},[y,l]);if(Re||!s||!Q)return e.jsx(he,{backAction:{content:"Review Queue",url:"/review"},title:"Loading...",children:e.jsx(Y,{padding:"600",children:e.jsx(c,{align:"center",children:e.jsx(Te,{size:"large"})})})});const Be=s.draft_title||s.original_title||`Product #${s.shopify_product_id}`,de=`https://admin.shopify.com/store/pictureline/products/${s.shopify_product_id}`,h=je.length>0?je:(s.draftImages||[]).filter(n=>n&&n.startsWith("http")),w=(Q.images||[]).filter(n=>n&&n.startsWith("http")),b=s.parsedTags||[],ce=E?.listingId||s.ebay_listing_id;return s.status!=="pending"&&j===1?e.jsxs(e.Fragment,{children:[e.jsx(he,{backAction:{content:"Review Queue",url:"/review"},title:Be,titleMetadata:ue(s.status),subtitle:`Created ${ne(s.created_at)}${s.reviewed_at?` Â· Reviewed ${ne(s.reviewed_at)}`:""}`,children:e.jsxs(S,{children:[e.jsxs(S.Section,{children:[e.jsx(d,{children:e.jsxs(t,{gap:"400",children:[e.jsxs(c,{gap:"200",blockAlign:"center",children:[e.jsx(i,{variant:"headingMd",as:"h2",children:"Photos"}),b.length>0&&e.jsx(A,{tags:b})]}),h.length>0?e.jsx(V,{imageUrls:h,onChange:le,onEditPhoto:n=>{P(n),I(h[n])},enableBulkEdit:!0,draftId:a}):e.jsx(k,{tone:"info",children:e.jsx(i,{as:"p",children:"No photos available."})})]})}),e.jsx(d,{children:e.jsxs(t,{gap:"300",children:[e.jsx(i,{variant:"headingMd",as:"h2",children:"Description"}),e.jsx(d,{background:"bg-surface-secondary",padding:"300",children:e.jsx(Y,{children:e.jsx("div",{dangerouslySetInnerHTML:{__html:s.draft_description||"<em>No description</em>"}})})})]})})]}),e.jsxs(S.Section,{variant:"oneThird",children:[e.jsx(d,{children:e.jsxs(t,{gap:"200",children:[e.jsx(i,{variant:"headingMd",as:"h2",children:"Status"}),ue(s.status),s.reviewed_at&&e.jsxs(i,{variant:"bodySm",as:"p",tone:"subdued",children:["Reviewed ",ne(s.reviewed_at)]})]})}),ce&&e.jsx(d,{children:e.jsxs(t,{gap:"300",children:[e.jsxs(c,{align:"space-between",blockAlign:"center",children:[e.jsx(i,{variant:"headingMd",as:"h2",children:"eBay Listing"}),e.jsx(u,{tone:"success",children:"Live"})]}),e.jsx(u,{tone:"success",children:`Listing #${ce}`}),e.jsx(x,{fullWidth:!0,icon:z,size:"slim",url:E?.ebayUrl||`https://www.ebay.com/itm/${ce}`,target:"_blank",children:"View on eBay"})]})}),e.jsx(d,{children:e.jsxs(t,{gap:"200",children:[e.jsx(i,{variant:"headingMd",as:"h2",children:"Product Info"}),e.jsx(x,{fullWidth:!0,icon:z,size:"slim",url:de,target:"_blank",children:"View in Shopify"})]})})]})]})}),e.jsx(X,{open:!!D,onClose:()=>U(null),title:"Photo preview",primaryAction:{content:"Close",onAction:()=>U(null)},children:e.jsx(X.Section,{children:e.jsx(c,{align:"center",children:D?e.jsx(Z,{source:D,alt:"Enlarged photo",size:"large"}):null})})}),O!==null&&G&&e.jsx(Le,{open:!0,imageUrl:G,draftId:a,imageIndex:O,allDraftImages:h.length>0?h:w,onSave:()=>{g.invalidateQueries({queryKey:["draft-detail",a]}),P(null),I(null),p({type:"success",title:"Photo updated",message:"Edited photo saved",autoClose:4e3})},onClose:()=>{P(null),I(null)},productId:s.shopify_product_id})]}):e.jsxs(e.Fragment,{children:[e.jsxs(he,{backAction:{content:"Review Queue",url:"/review"},title:Be,titleMetadata:ue(s.status),subtitle:`Created ${ne(s.created_at)}`,pagination:B.length>0&&j===1?{hasPrevious:N!==null,hasNext:y!==null,onPrevious:()=>N&&l(`/review/${N}`),onNext:()=>y&&l(`/review/${y}`),label:`${M+1} of ${B.length}`}:void 0,children:[e.jsx(an,{currentStep:j}),j===1&&e.jsxs(S,{children:[e.jsxs(S.Section,{children:[b.length>0&&e.jsx("div",{style:{marginBottom:"16px"},children:e.jsx(d,{children:e.jsxs(c,{gap:"300",blockAlign:"center",children:[e.jsx(i,{variant:"headingSm",as:"h3",children:"Condition from TIM:"}),e.jsx(A,{tags:b}),e.jsx(i,{variant:"bodySm",as:"p",tone:"subdued",children:(()=>{const n=Ne(b);return n?n.label:b.filter(m=>m.startsWith("condition-")).join(", ")})()})]})})}),e.jsx(d,{children:e.jsxs(t,{gap:"400",children:[e.jsxs(c,{align:"space-between",blockAlign:"center",children:[e.jsx(i,{variant:"headingMd",as:"h2",children:"Photos"}),e.jsx(u,{children:`${h.length} draft${w.length>0?` Â· ${w.length} live`:""}`})]}),h.length===0&&w.length===0?e.jsx(k,{tone:"info",children:e.jsx(i,{as:"p",children:"No photos available for this draft."})}):h.length>0&&w.length>0?e.jsxs(J,{columns:{xs:1,sm:2},gap:"600",children:[e.jsxs(t,{gap:"300",children:[e.jsx(i,{variant:"headingSm",as:"h3",tone:"subdued",children:"âœ¨ New Draft Photos"}),e.jsx(V,{imageUrls:h,onChange:le,onEditPhoto:n=>{P(n),I(h[n]||w[n]||null)},enableBulkEdit:!0,draftId:a})]}),e.jsxs(t,{gap:"300",children:[e.jsx(i,{variant:"headingSm",as:"h3",tone:"subdued",children:"ðŸ“· Current Live Photos"}),e.jsx(J,{columns:{xs:2,sm:2},gap:"200",children:w.map((n,m)=>e.jsx(d,{padding:"200",children:e.jsxs(t,{gap:"200",inlineAlign:"center",children:[e.jsx(Z,{source:n,alt:`Live photo ${m+1}`,size:"large"}),e.jsx(x,{variant:"plain",icon:Xe,onClick:()=>U(n),children:"View"})]})},`live-${m}`))})]})]}):h.length>0?e.jsxs(t,{gap:"200",children:[e.jsx(i,{variant:"headingSm",as:"h3",tone:"subdued",children:"âœ¨ New Draft Photos â€” drag to reorder"}),e.jsx(V,{imageUrls:h,onChange:le,onEditPhoto:n=>{P(n),I(h[n]||w[n]||null)},enableBulkEdit:!0,draftId:a})]}):e.jsxs(t,{gap:"200",children:[e.jsx(i,{variant:"headingSm",as:"h3",tone:"subdued",children:"ðŸ“· Current Live Photos â€” drag to reorder"}),e.jsx(V,{imageUrls:w,onChange:async n=>{te(n),await oe.mutateAsync(n)},onEditPhoto:n=>{P(n),I(w[n])},enableBulkEdit:!0,draftId:a})]})]})}),e.jsx(d,{children:e.jsxs(t,{gap:"400",children:[e.jsx(i,{variant:"headingMd",as:"h2",children:"Title"}),s.original_title&&s.original_title!==T&&e.jsxs(t,{gap:"200",children:[e.jsx(i,{variant:"headingSm",as:"h3",tone:"subdued",children:"ðŸ“„ Original Title"}),e.jsx(d,{background:"bg-surface-secondary",padding:"300",children:e.jsx(i,{as:"p",children:s.original_title})})]}),e.jsxs(t,{gap:"200",children:[e.jsx(i,{variant:"headingSm",as:"h3",tone:"subdued",children:"âœ¨ AI-Generated Title"}),e.jsx(ee,{label:"",labelHidden:!0,value:T,onChange:ge,autoComplete:"off",placeholder:"Product title"})]})]})}),e.jsx(d,{children:e.jsxs(t,{gap:"400",children:[e.jsx(i,{variant:"headingMd",as:"h2",children:"Description"}),Q.description?e.jsxs(J,{columns:{xs:1,sm:2},gap:"400",children:[e.jsxs(t,{gap:"200",children:[e.jsx(i,{variant:"headingSm",as:"h3",tone:"subdued",children:"ðŸ“„ Current Live Description"}),e.jsx(d,{background:"bg-surface-secondary",padding:"300",children:e.jsx(Y,{children:e.jsx("div",{style:{maxHeight:"400px",overflow:"auto",fontSize:"13px",lineHeight:"1.6"},dangerouslySetInnerHTML:{__html:Q.description}})})})]}),e.jsxs(t,{gap:"200",children:[e.jsx(i,{variant:"headingSm",as:"h3",tone:"subdued",children:"âœ¨ AI-Generated Description"}),e.jsx(ee,{label:"",labelHidden:!0,value:C,onChange:ie,multiline:14,autoComplete:"off"})]})]}):e.jsxs(t,{gap:"200",children:[e.jsx(i,{variant:"headingSm",as:"h3",tone:"subdued",children:"âœ¨ AI-Generated Description"}),e.jsx(ee,{label:"",labelHidden:!0,value:C,onChange:ie,multiline:12,autoComplete:"off"})]})]})})]}),e.jsx(S.Section,{variant:"oneThird",children:e.jsxs("div",{style:{position:"sticky",top:"16px"},children:[e.jsx(d,{children:e.jsxs(t,{gap:"400",children:[e.jsx(i,{variant:"headingMd",as:"h2",children:"Step 1 Actions"}),b.length>0&&e.jsxs(t,{gap:"100",children:[e.jsx(i,{variant:"bodySm",as:"p",tone:"subdued",children:"Condition Grade"}),e.jsx(A,{tags:b})]}),e.jsx(L,{}),e.jsx(x,{variant:"primary",tone:"success",size:"large",fullWidth:!0,icon:De,onClick:Ue,loading:re.isPending,children:"Approve Content â†’"}),e.jsx(i,{variant:"bodySm",as:"p",tone:"subdued",alignment:"center",children:"Advances to Shopify preview"}),e.jsx(L,{}),e.jsx(x,{fullWidth:!0,tone:"critical",icon:Ze,onClick:()=>Ee.mutate(),loading:Ee.isPending,children:"Reject Draft"})]})}),e.jsx("div",{style:{marginTop:"16px"},children:e.jsx(d,{children:e.jsxs(t,{gap:"300",children:[e.jsx(i,{variant:"headingMd",as:"h2",children:"Product Info"}),e.jsxs(t,{gap:"200",children:[e.jsxs(c,{align:"space-between",children:[e.jsx(i,{variant:"bodySm",as:"span",tone:"subdued",children:"Shopify ID"}),e.jsx(i,{variant:"bodySm",as:"span",children:s.shopify_product_id})]}),e.jsxs(c,{align:"space-between",children:[e.jsx(i,{variant:"bodySm",as:"span",tone:"subdued",children:"Photos"}),e.jsxs(i,{variant:"bodySm",as:"span",children:[h.length," draft"]})]}),e.jsxs(c,{align:"space-between",children:[e.jsx(i,{variant:"bodySm",as:"span",tone:"subdued",children:"Description"}),e.jsx(u,{tone:s.draft_description?"success":"critical",children:s.draft_description?"Generated":"Missing"})]})]}),e.jsx(x,{fullWidth:!0,icon:z,size:"slim",url:de,target:"_blank",children:"View in Shopify"})]})})}),ae&&e.jsx("div",{style:{marginTop:"16px"},children:e.jsx(d,{children:e.jsxs(t,{gap:"300",children:[e.jsxs(c,{align:"space-between",blockAlign:"center",children:[e.jsx(i,{variant:"headingMd",as:"h2",children:"Notes"}),q.trim()&&e.jsx(u,{tone:"attention",children:"Has Notes"})]}),e.jsx(ee,{label:"",labelHidden:!0,value:q,onChange:se,multiline:3,placeholder:"Condition notes, blemishes, etc.",autoComplete:"off",onBlur:()=>{q!==(K?.notes??"")&&ze.mutate({productId:ae,notes:q})}}),e.jsx(i,{variant:"bodySm",as:"p",tone:"subdued",children:"Auto-saves on blur."})]})})})]})})]}),j===2&&e.jsxs(S,{children:[e.jsxs(S.Section,{children:[F?e.jsxs(t,{gap:"300",children:[e.jsx(k,{tone:"success",children:e.jsxs(t,{gap:"200",children:[e.jsx(i,{variant:"headingMd",as:"h2",children:"âœ… Saved to Shopify!"}),e.jsx(i,{as:"p",children:"Title, description, and photos have been pushed to your Shopify product."})]})}),We===!1&&e.jsx(k,{tone:"warning",children:e.jsx(i,{as:"p",children:"Content saved but product was not published on Shopify."})})]}):e.jsx(k,{tone:"info",children:e.jsx(i,{as:"p",children:'Review the content below. This is exactly what will be pushed to Shopify when you click "Save to Shopify".'})}),e.jsx("div",{style:{marginTop:"16px"},children:e.jsx(d,{children:e.jsxs(t,{gap:"400",children:[e.jsxs(c,{align:"space-between",blockAlign:"center",children:[e.jsx(i,{variant:"headingMd",as:"h2",children:"Photos to Publish"}),e.jsx(u,{tone:h.length>0?"success":"critical",children:`${h.length} photo${h.length!==1?"s":""}`})]}),h.length>0?e.jsx(J,{columns:{xs:3,sm:4,md:5},gap:"200",children:h.map((n,m)=>e.jsx("div",{style:{position:"relative"},children:e.jsx(d,{padding:"200",children:e.jsxs(t,{gap:"100",inlineAlign:"center",children:[e.jsx(Z,{source:n,alt:`Photo ${m+1}`,size:"large"}),m===0&&e.jsx(u,{tone:"success",children:"Main"})]})})},m))}):e.jsx(k,{tone:"warning",children:e.jsx(i,{as:"p",children:"No photos to publish."})})]})})}),e.jsx("div",{style:{marginTop:"16px"},children:e.jsx(d,{children:e.jsxs(t,{gap:"300",children:[e.jsx(i,{variant:"headingMd",as:"h2",children:"Title to Publish"}),e.jsx(d,{background:"bg-surface-secondary",padding:"300",children:e.jsx(i,{as:"p",fontWeight:"semibold",children:T||s.draft_title||"(no title)"})})]})})}),e.jsx("div",{style:{marginTop:"16px"},children:e.jsx(d,{children:e.jsxs(t,{gap:"300",children:[e.jsxs(c,{align:"space-between",blockAlign:"center",children:[e.jsx(i,{variant:"headingMd",as:"h2",children:"Description to Publish"}),b.length>0&&e.jsx(A,{tags:b})]}),e.jsx(d,{background:"bg-surface-secondary",padding:"300",children:e.jsx(Y,{children:e.jsx("div",{style:{maxHeight:"500px",overflow:"auto"},dangerouslySetInnerHTML:{__html:C||s.draft_description||"<em>No description</em>"}})})})]})})})]}),e.jsx(S.Section,{variant:"oneThird",children:e.jsx("div",{style:{position:"sticky",top:"16px"},children:e.jsx(d,{children:e.jsxs(t,{gap:"400",children:[e.jsx(i,{variant:"headingMd",as:"h2",children:"Step 2: Save to Shopify"}),b.length>0&&e.jsxs(t,{gap:"100",children:[e.jsx(i,{variant:"bodySm",as:"p",tone:"subdued",children:"Condition Grade"}),e.jsx(A,{tags:b})]}),e.jsxs(t,{gap:"200",children:[e.jsxs(c,{align:"space-between",children:[e.jsx(i,{variant:"bodySm",as:"span",tone:"subdued",children:"Photos"}),e.jsxs(i,{variant:"bodySm",as:"span",children:[h.length," to upload"]})]}),e.jsxs(c,{align:"space-between",children:[e.jsx(i,{variant:"bodySm",as:"span",tone:"subdued",children:"Title"}),e.jsx(u,{tone:"success",children:"Ready"})]}),e.jsxs(c,{align:"space-between",children:[e.jsx(i,{variant:"bodySm",as:"span",tone:"subdued",children:"Description"}),e.jsx(u,{tone:C?"success":"warning",children:C?"Ready":"Empty"})]})]}),e.jsx(L,{}),F?e.jsx(i,{variant:"bodyMd",as:"p",tone:"success",fontWeight:"semibold",children:"âœ… Saved to Shopify â€” advancing to eBayâ€¦"}):e.jsxs(t,{gap:"300",children:[e.jsx(Je,{label:"Publish on Shopify",helpText:"Make this product visible in your store",checked:Se,onChange:$e}),e.jsx(x,{variant:"primary",tone:"success",size:"large",fullWidth:!0,onClick:Fe,loading:H.isPending,icon:De,children:"Save to Shopify"})]}),F&&e.jsx(x,{fullWidth:!0,variant:"plain",url:de,target:"_blank",icon:z,children:"View in Shopify"}),e.jsx(L,{}),e.jsx(x,{fullWidth:!0,icon:Me,onClick:()=>v(1),disabled:H.isPending,children:"â† Back to Review"})]})})})})]}),j===3&&e.jsxs(S,{children:[e.jsx(S.Section,{children:E?e.jsxs(t,{gap:"400",children:[e.jsx(k,{tone:"success",children:e.jsxs(t,{gap:"300",children:[e.jsx(i,{variant:"headingMd",as:"h2",children:"ðŸŽ‰ Listed on eBay!"}),e.jsx(i,{as:"p",children:"Your product is now live on eBay."}),e.jsx(c,{gap:"200",children:e.jsx(u,{tone:"success",children:`Listing #${E.listingId}`})})]})}),e.jsxs(c,{gap:"200",children:[e.jsx(x,{variant:"primary",icon:z,url:E.ebayUrl,target:"_blank",children:"View on eBay"}),e.jsx(x,{onClick:_e,children:y?"Next Draft â†’":"Back to Queue"})]})]}):e.jsxs(t,{gap:"400",children:[e.jsx(k,{tone:"info",children:e.jsx(i,{as:"p",children:'Review the eBay listing preview below. Click "Publish to eBay" to go live, or use "Edit Listing Details" for full control over price, category, and item specifics.'})}),$.isPending&&!f?e.jsx(d,{children:e.jsxs(t,{gap:"400",children:[e.jsx(c,{align:"center",children:e.jsx(Te,{size:"large"})}),e.jsx(i,{alignment:"center",as:"p",tone:"subdued",children:"Loading eBay listing dataâ€¦"})]})}):f?e.jsxs(t,{gap:"400",children:[e.jsx(rn,{preview:f}),b.length>0&&e.jsx(d,{children:e.jsxs(t,{gap:"300",children:[e.jsx(i,{variant:"headingMd",as:"h2",children:"Condition Details"}),e.jsxs(c,{gap:"300",blockAlign:"center",children:[e.jsx(A,{tags:b}),f.conditionDescription&&e.jsxs(i,{variant:"bodySm",as:"p",tone:"subdued",children:['"',f.conditionDescription,'"']})]}),e.jsxs(t,{gap:"100",children:[e.jsx(i,{variant:"bodySm",as:"span",tone:"subdued",children:"eBay Condition Grade"}),e.jsx(i,{variant:"bodySm",as:"span",fontWeight:"semibold",children:xe[f.condition]||f.condition})]})]})})]}):$.isError?e.jsx(k,{tone:"warning",children:e.jsxs(t,{gap:"200",children:[e.jsx(i,{as:"p",children:"Could not load eBay preview. You can still publish, or use the full prep page for more control."}),e.jsx(x,{icon:en,onClick:()=>$.mutate(),size:"slim",children:"Retry"})]})}):null]})}),e.jsx(S.Section,{variant:"oneThird",children:e.jsx("div",{style:{position:"sticky",top:"16px"},children:E?e.jsx(d,{children:e.jsxs(t,{gap:"300",children:[e.jsxs(c,{align:"space-between",blockAlign:"center",children:[e.jsx(i,{variant:"headingMd",as:"h2",children:"eBay Listing"}),e.jsx(u,{tone:"success",children:"Live"})]}),e.jsx(u,{tone:"success",children:`Listing #${E.listingId}`}),e.jsx(x,{fullWidth:!0,icon:z,url:E.ebayUrl,target:"_blank",children:"View on eBay"}),e.jsx(x,{fullWidth:!0,variant:"primary",onClick:_e,children:y?"Next Draft â†’":"Back to Queue"})]})}):e.jsx(d,{children:e.jsxs(t,{gap:"400",children:[e.jsx(i,{variant:"headingMd",as:"h2",children:"Step 3: List on eBay"}),b.length>0&&e.jsxs(t,{gap:"100",children:[e.jsx(i,{variant:"bodySm",as:"p",tone:"subdued",children:"Condition Grade"}),e.jsx(A,{tags:b})]}),f&&e.jsxs(t,{gap:"200",children:[e.jsxs(c,{align:"space-between",children:[e.jsx(i,{variant:"bodySm",as:"span",tone:"subdued",children:"Price"}),e.jsxs(i,{variant:"bodySm",as:"span",fontWeight:"semibold",children:["$",f.price]})]}),e.jsxs(c,{align:"space-between",children:[e.jsx(i,{variant:"bodySm",as:"span",tone:"subdued",children:"Condition"}),e.jsx(i,{variant:"bodySm",as:"span",children:xe[f.condition]||f.condition})]}),e.jsxs(c,{align:"space-between",children:[e.jsx(i,{variant:"bodySm",as:"span",tone:"subdued",children:"Photos"}),e.jsxs(i,{variant:"bodySm",as:"span",children:[f.imageUrls.length," images"]})]}),e.jsxs(c,{align:"space-between",children:[e.jsx(i,{variant:"bodySm",as:"span",tone:"subdued",children:"Category"}),e.jsx(i,{variant:"bodySm",as:"span",children:f.categoryName||f.categoryId})]})]}),e.jsx(L,{}),e.jsx(x,{variant:"primary",tone:"success",size:"large",fullWidth:!0,onClick:()=>W.mutate(),loading:W.isPending,disabled:W.isPending,children:"ðŸ›ï¸ Publish to eBay"}),e.jsx(x,{fullWidth:!0,icon:nn,url:`/review/${a}/ebay-prep`,disabled:W.isPending,children:"Edit Listing Details"}),e.jsx(L,{}),e.jsx(x,{fullWidth:!0,variant:"plain",onClick:Oe,disabled:W.isPending,children:"Skip eBay â€” Finish"}),e.jsx(x,{fullWidth:!0,icon:Me,onClick:()=>v(2),disabled:W.isPending,children:"â† Back"})]})})})})]})]}),e.jsx(X,{open:!!D,onClose:()=>U(null),title:"Photo preview",primaryAction:{content:"Close",onAction:()=>U(null)},children:e.jsx(X.Section,{children:e.jsx(c,{align:"center",children:D?e.jsx(Z,{source:D,alt:"Enlarged photo",size:"large"}):null})})}),O!==null&&s&&G&&e.jsx(Le,{open:!0,imageUrl:G,draftId:a,imageIndex:O,allDraftImages:h.length>0?h:w,onSave:()=>{g.invalidateQueries({queryKey:["draft-detail",a]}),P(null),I(null),p({type:"success",title:"Photo updated",message:"Edited photo saved",autoClose:4e3})},onClose:()=>{P(null),I(null)},productId:s.shopify_product_id})]})};export{pn as default};
