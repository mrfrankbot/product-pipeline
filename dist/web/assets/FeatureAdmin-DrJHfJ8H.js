import{r as a,j as e,R as N}from"./vendor-react-DzgxJkbp.js";import{a as Q,u as W,b as I}from"./vendor-query-BeqrpgNA.js";import{f as m}from"./index-DJAOEm-v.js";import{P as A,B as R,T as i,L as D,C as H,$ as U,b as l,h as z,ag as G,a as c,D as J,I as r,c as E,am as O,ah as V,u as X,o as b,W as Y,al as Z,a0 as F,E as ee,e as n}from"./vendor-polaris-o1SQP_xq.js";const P=["all","new","planned","in_progress","completed","declined"],te=s=>{switch(s){case"new":return e.jsx(n,{tone:"info",children:"New"});case"planned":return e.jsx(n,{tone:"attention",children:"Planned"});case"in_progress":return e.jsx(n,{tone:"warning",children:"In Progress"});case"completed":return e.jsx(n,{tone:"success",children:"Completed"});case"declined":return e.jsx(n,{children:"Declined"});default:return e.jsx(n,{children:s})}},ne=s=>{switch(s){case"critical":return e.jsx(n,{tone:"critical",children:"Critical"});case"high":return e.jsx(n,{tone:"warning",children:"High"});case"medium":return e.jsx(n,{tone:"info",children:"Medium"});case"low":return e.jsx(n,{children:"Low"});default:return e.jsx(n,{children:s})}},le=()=>{const s=Q(),[y,T]=a.useState(0),[u,o]=a.useState(null),[h,S]=a.useState(""),[p,v]=a.useState(""),[x,C]=a.useState(""),d=P[y],{data:_,isLoading:$,error:k}=W({queryKey:["features-admin",d],queryFn:()=>{const t=d==="all"?"":`?status=${d}`;return m.get(`/features${t}`)}}),g=I({mutationFn:({id:t,...j})=>m.put(`/features/${t}`,j),onSuccess:()=>{s.invalidateQueries({queryKey:["features-admin"]}),s.invalidateQueries({queryKey:["features"]}),o(null)}}),L=I({mutationFn:t=>m.delete(`/features/${t}`),onSuccess:()=>{s.invalidateQueries({queryKey:["features-admin"]}),s.invalidateQueries({queryKey:["features"]})}}),w=a.useCallback(t=>{if(u===t.id){o(null);return}o(t.id),S(t.status),v(t.priority||"medium"),C(t.admin_notes||"")},[u]),K=a.useCallback(t=>{g.mutate({id:t,status:h,priority:p,admin_notes:x||void 0})},[h,p,x,g]),M=P.map(t=>({id:t,content:t==="in_progress"?"In Progress":t.charAt(0).toUpperCase()+t.slice(1),accessibilityLabel:`${t} feature requests`,panelID:`${t}-panel`})),q=_?.data||[];return k?e.jsx(A,{title:"Feature Admin",subtitle:"Manage feature requests — set status, priority, and notes",children:e.jsx(R,{tone:"critical",title:"Failed to load feature requests",children:e.jsx(i,{as:"p",children:k.message})})}):e.jsx(A,{title:"Feature Admin",subtitle:"Manage feature requests — set status, priority, and notes",children:e.jsx(D,{children:e.jsx(D.Section,{children:e.jsx(H,{children:e.jsx(U,{tabs:M,selected:y,onSelect:T,children:e.jsx(l,{paddingBlockStart:"400",children:$?e.jsx(z,{lines:8}):q.length===0?e.jsx(G,{heading:"No feature requests found",image:"",children:e.jsxs(i,{as:"p",children:["No ",d==="all"?"":d," feature requests yet."]})}):e.jsx(c,{gap:"0",children:q.map((t,j)=>{const f=u===t.id;return e.jsxs(N.Fragment,{children:[j>0&&e.jsx(J,{}),e.jsx(l,{padding:"400",children:e.jsxs(c,{gap:"200",children:[e.jsx("div",{onClick:()=>w(t),role:"button",tabIndex:0,onKeyDown:B=>{(B.key==="Enter"||B.key===" ")&&w(t)},style:{cursor:"pointer"},children:e.jsxs(r,{align:"space-between",blockAlign:"center",wrap:!0,children:[e.jsxs(r,{gap:"200",blockAlign:"center",children:[e.jsx(E,{source:f?O:V,tone:"subdued"}),e.jsxs(c,{gap:"050",children:[e.jsx(i,{variant:"bodyMd",fontWeight:"semibold",as:"span",children:t.title.length>60?t.title.slice(0,60)+"…":t.title}),e.jsxs(i,{variant:"bodySm",tone:"subdued",as:"span",children:["#",t.id," ·"," ",t.requested_by?`By ${t.requested_by}`:"Anonymous"," ·"," ",new Date(t.created_at).toLocaleDateString()]})]})]}),e.jsxs(r,{gap:"200",blockAlign:"center",children:[e.jsxs(r,{gap:"100",blockAlign:"center",children:[e.jsx(E,{source:X,tone:"subdued"}),e.jsx(i,{variant:"bodySm",fontWeight:"semibold",as:"span",children:t.votes??0})]}),ne(t.priority),te(t.status)]})]})}),e.jsx(r,{gap:"200",children:e.jsx(b,{size:"slim",tone:"critical",onClick:()=>{confirm(`Delete feature request #${t.id}?`)&&L.mutate(t.id)},children:"Delete"})}),e.jsx(Y,{open:f,id:`edit-feature-${t.id}`,children:e.jsx(l,{paddingBlockStart:"400",paddingBlockEnd:"200",borderBlockStartWidth:"025",borderColor:"border",children:e.jsxs(Z,{children:[e.jsxs(c,{gap:"100",children:[e.jsx(i,{variant:"headingSm",as:"h3",children:"Description"}),e.jsx(l,{background:"bg-fill-secondary",borderRadius:"200",padding:"300",children:e.jsx(i,{as:"p",children:t.description})})]}),e.jsxs(r,{gap:"400",wrap:!0,children:[e.jsx(l,{minWidth:"200px",children:e.jsx(F,{label:"Status",options:[{label:"New",value:"new"},{label:"Planned",value:"planned"},{label:"In Progress",value:"in_progress"},{label:"Completed",value:"completed"},{label:"Declined",value:"declined"}],value:h,onChange:S})}),e.jsx(l,{minWidth:"200px",children:e.jsx(F,{label:"Priority",options:[{label:"Low",value:"low"},{label:"Medium",value:"medium"},{label:"High",value:"high"},{label:"Critical",value:"critical"}],value:p,onChange:v})})]}),e.jsx(ee,{label:"Admin notes",value:x,onChange:C,multiline:3,placeholder:"Internal notes about this request…",autoComplete:"off"}),e.jsxs(r,{gap:"200",children:[e.jsx(b,{variant:"primary",onClick:()=>K(t.id),loading:g.isPending,children:"Save"}),e.jsx(b,{onClick:()=>o(null),children:"Cancel"})]})]})})})]})})]},t.id)})})})})})})})})};export{le as default};
