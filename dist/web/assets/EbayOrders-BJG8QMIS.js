import{r as d,j as e,R as W}from"./vendor-react-DzgxJkbp.js";import{w as H,x as J,y as q}from"./index-DJAOEm-v.js";import{H as r,T as n,e as S,P as K,a as u,B as Y,L as N,C as f,I as c,b as h,c as m,a7 as z,a0 as L,o as D,f as Q,j as F,ac as A,d as X,G as Z,E as $,J as V,x as ee,Q as se,aw as ae,D as ne,ax as te}from"./vendor-polaris-o1SQP_xq.js";import"./vendor-query-BeqrpgNA.js";const g=25,le=[{label:"All fulfillment",value:""},{label:"Fulfilled",value:"FULFILLED"},{label:"Not Started",value:"NOT_STARTED"},{label:"In Progress",value:"IN_PROGRESS"}],ie=[{label:"All payment",value:""},{label:"Paid",value:"PAID"},{label:"Pending",value:"PENDING"},{label:"Failed",value:"FAILED"}],re=[{label:"Last 7 days",value:"7"},{label:"Last 30 days",value:"30"},{label:"Last 60 days",value:"60"},{label:"Last 90 days",value:"90"}],P=(a,t="USD")=>a==null?"—":new Intl.NumberFormat("en-US",{style:"currency",currency:t}).format(a),ce=a=>{if(!a)return"—";const t=new Date(a);return isNaN(t.getTime())?"—":t.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})},de=a=>{if(!a)return"Never";const t=new Date(a*1e3);return isNaN(t.getTime())?"Never":t.toLocaleString()},oe=a=>{switch(a){case"FULFILLED":return"success";case"IN_PROGRESS":return"attention";case"NOT_STARTED":return"warning";default:return"info"}},ue=a=>{switch(a){case"PAID":return"success";case"FAILED":return"critical";case"PENDING":return"attention";default:return"info"}},_=({label:a,value:t,icon:l,tone:i})=>e.jsx(f,{children:e.jsxs(u,{gap:"200",children:[e.jsx(c,{align:"space-between",blockAlign:"center",children:e.jsx(h,{background:i==="success"?"bg-fill-success-secondary":i==="critical"?"bg-fill-critical-secondary":i==="warning"?"bg-fill-warning-secondary":"bg-fill-secondary",borderRadius:"200",padding:"200",children:e.jsx(m,{source:l,tone:i??"base"})})}),e.jsx(n,{variant:"headingXl",as:"p",children:typeof t=="number"?t.toLocaleString():t}),e.jsx(n,{variant:"bodySm",tone:"subdued",as:"p",children:a})]})}),he=({order:a})=>{const t=d.useMemo(()=>{try{return JSON.parse(a.line_items_json||"[]")}catch{return[]}},[a.line_items_json]),l=d.useMemo(()=>{try{return a.shipping_address_json?JSON.parse(a.shipping_address_json):null}catch{return null}},[a.shipping_address_json]);return e.jsx(h,{padding:"400",background:"bg-surface-secondary",children:e.jsxs(u,{gap:"400",children:[e.jsxs(c,{gap:"800",align:"start",children:[e.jsxs(u,{gap:"200",children:[e.jsxs(c,{gap:"200",blockAlign:"center",children:[e.jsx(h,{background:"bg-fill-secondary",borderRadius:"200",padding:"200",children:e.jsx(m,{source:F})}),e.jsx(n,{variant:"headingSm",as:"h3",children:"Line Items"})]}),t.length===0&&e.jsx(n,{as:"p",tone:"subdued",children:"No line items"}),t.map((i,j)=>e.jsxs(c,{gap:"200",blockAlign:"center",children:[e.jsxs(n,{as:"span",variant:"bodySm",fontWeight:"semibold",children:[i.quantity??1,"×"]}),e.jsx(n,{as:"span",variant:"bodySm",children:i.title||i.legacyItemId||"Unknown item"}),i.lineItemCost&&e.jsx(n,{as:"span",variant:"bodySm",tone:"subdued",children:P(parseFloat(i.lineItemCost.value),i.lineItemCost.currency)})]},j))]}),l&&e.jsxs(u,{gap:"200",children:[e.jsxs(c,{gap:"200",blockAlign:"center",children:[e.jsx(h,{background:"bg-fill-secondary",borderRadius:"200",padding:"200",children:e.jsx(m,{source:ae})}),e.jsx(n,{variant:"headingSm",as:"h3",children:"Shipping Address"})]}),e.jsx(n,{as:"p",variant:"bodySm",children:l.fullName}),l.contactAddress&&e.jsxs(e.Fragment,{children:[e.jsx(n,{as:"p",variant:"bodySm",children:l.contactAddress.addressLine1}),l.contactAddress.addressLine2&&e.jsx(n,{as:"p",variant:"bodySm",children:l.contactAddress.addressLine2}),e.jsxs(n,{as:"p",variant:"bodySm",children:[l.contactAddress.city,", ",l.contactAddress.stateOrProvince," ",l.contactAddress.postalCode]})]})]})]}),e.jsx(ne,{}),e.jsx(c,{gap:"200",children:e.jsx(te,{content:"Coming soon",children:e.jsx(D,{disabled:!0,children:"Sync to Shopify"})})})]})})},je=()=>{const[a,t]=d.useState(""),[l,i]=d.useState(""),[j,E]=d.useState(""),[o,p]=d.useState(0),[I,k]=d.useState("30"),[C,R]=d.useState(null),{data:O,isLoading:w}=H({limit:g,offset:o,search:a||void 0,fulfillmentStatus:l||void 0,paymentStatus:j||void 0}),{data:x}=J(),v=q(),T=O?.data??[],b=O?.total??0,B=o>0,U=o+g<b,M=d.useCallback(()=>{v.mutate({days:parseInt(I)})},[I,v]),G=T.map((s,y)=>e.jsxs(W.Fragment,{children:[e.jsxs(r.Row,{id:String(s.id),position:y,onClick:()=>R(C===s.id?null:s.id),selected:!1,children:[e.jsx(r.Cell,{children:e.jsx(n,{variant:"bodyMd",fontWeight:"semibold",as:"span",children:s.legacy_order_id||s.ebay_order_id})}),e.jsx(r.Cell,{children:s.buyer_username||"—"}),e.jsx(r.Cell,{children:s.item_count??0}),e.jsx(r.Cell,{children:P(s.total_amount,s.currency)}),e.jsx(r.Cell,{children:e.jsx(S,{tone:oe(s.fulfillment_status),children:s.fulfillment_status||"UNKNOWN"})}),e.jsx(r.Cell,{children:e.jsx(S,{tone:ue(s.payment_status),children:s.payment_status||"UNKNOWN"})}),e.jsx(r.Cell,{children:ce(s.ebay_created_at)}),e.jsx(r.Cell,{children:s.synced_to_shopify?e.jsx(S,{tone:"success",children:"Synced"}):e.jsx(S,{tone:"info",children:"Not synced"})})]}),C===s.id&&e.jsx(r.Row,{id:`${s.id}-detail`,position:y,selected:!1,children:e.jsx(r.Cell,{colSpan:8,children:e.jsx(he,{order:s})})})]},s.id));return e.jsx(K,{title:"eBay Orders",subtitle:"Import and manage eBay orders",fullWidth:!0,children:e.jsxs(u,{gap:"500",children:[e.jsx(Y,{tone:"critical",title:"⚠️ Lightspeed POS Impact — Read Before Syncing",children:e.jsxs(u,{gap:"200",children:[e.jsxs(n,{as:"p",children:[e.jsx("strong",{children:"Every Shopify order created here flows into Lightspeed POS automatically."})," ","Duplicate orders caused hours of manual cleanup in February 2026."]}),e.jsxs(n,{as:"p",children:["The ",e.jsx("strong",{children:"Import from eBay"})," button is safe — it only stores orders to the local database. Syncing to Shopify requires explicit confirmation and is rate-limited to 5 orders/hour."]}),e.jsxs(n,{as:"p",tone:"critical",children:["If you suspect duplicates exist in Shopify, ",e.jsx("strong",{children:"stop immediately"})," and contact the developer."]})]})}),e.jsxs(N,{children:[e.jsx(N.Section,{variant:"oneThird",children:e.jsx(f,{children:e.jsxs(u,{gap:"300",children:[e.jsxs(c,{gap:"200",blockAlign:"center",children:[e.jsx(h,{background:"bg-fill-secondary",borderRadius:"200",padding:"200",children:e.jsx(m,{source:z})}),e.jsx(n,{variant:"headingSm",as:"h2",children:"Import from eBay"})]}),e.jsx(L,{label:"Time range",options:re,value:I,onChange:k}),e.jsx(D,{variant:"primary",onClick:M,loading:v.isPending,fullWidth:!0,children:"Import Orders"}),x?.lastImportedAt&&e.jsxs(n,{as:"p",variant:"bodySm",tone:"subdued",children:["Last import: ",de(x.lastImportedAt)]})]})})}),e.jsx(N.Section,{children:e.jsxs(Q,{columns:{xs:2,sm:4},gap:"300",children:[e.jsx(_,{label:"Total Orders",value:x?.total??0,icon:F}),x?.byFulfillmentStatus&&Object.entries(x.byFulfillmentStatus).map(([s,y])=>e.jsx(_,{label:s,value:y,icon:s==="FULFILLED"?A:s==="NOT_STARTED"?X:Z,tone:s==="FULFILLED"?"success":s==="NOT_STARTED"?"warning":"info"},s)),e.jsx(_,{label:"Synced",value:x?.synced??0,icon:A,tone:"success"})]})})]}),e.jsx(f,{children:e.jsxs(c,{gap:"300",align:"start",blockAlign:"end",children:[e.jsx(h,{minWidth:"280px",children:e.jsx($,{label:"Search",labelHidden:!0,placeholder:"Search order ID or buyer…",value:a,onChange:s=>{t(s),p(0)},prefix:e.jsx(m,{source:V}),autoComplete:"off",clearButton:!0,onClearButtonClick:()=>{t(""),p(0)}})}),e.jsx(L,{label:"Fulfillment",labelHidden:!0,options:le,value:l,onChange:s=>{i(s),p(0)}}),e.jsx(L,{label:"Payment",labelHidden:!0,options:ie,value:j,onChange:s=>{E(s),p(0)}})]})}),e.jsx(f,{padding:"0",children:w?e.jsx(h,{padding:"800",children:e.jsx(c,{align:"center",children:e.jsx(ee,{accessibilityLabel:"Loading orders",size:"large"})})}):e.jsx(r,{resourceName:{singular:"order",plural:"orders"},itemCount:T.length,headings:[{title:"Order ID"},{title:"Buyer"},{title:"Items"},{title:"Total"},{title:"Fulfillment"},{title:"Payment"},{title:"Date"},{title:"Synced"}],selectable:!1,children:G})}),b>g&&e.jsxs(c,{align:"center",gap:"300",children:[e.jsx(se,{hasPrevious:B,hasNext:U,onPrevious:()=>p(Math.max(0,o-g)),onNext:()=>p(o+g)}),e.jsxs(n,{as:"p",variant:"bodySm",tone:"subdued",children:[o+1,"–",Math.min(o+g,b)," of ",b]})]})]})})};export{je as default};
