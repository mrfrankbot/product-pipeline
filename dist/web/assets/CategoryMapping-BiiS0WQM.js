import{u as K,r as M,j as e}from"./vendor-react-DzgxJkbp.js";import{a as Q,u as N,b as U}from"./vendor-query-BeqrpgNA.js";import{u as G,f as T}from"./index-DJAOEm-v.js";import{P as V,a as n,C as S,I as l,b as I,c as w,S as W,d as H,T as a,e as y,L as b,n as J,o as C,V as O,a0 as X,ac as Y,m as Z}from"./vendor-polaris-o1SQP_xq.js";const P=({category:o,templates:f,defaultTemplate:s,onChangeTemplate:r,onCreateTemplate:c})=>e.jsx(S,{children:e.jsxs(l,{align:"space-between",blockAlign:"center",children:[e.jsxs(l,{gap:"300",blockAlign:"center",children:[e.jsx(I,{background:s?"bg-fill-success-secondary":"bg-fill-secondary",borderRadius:"200",padding:"200",children:e.jsx(w,{source:s?Y:Z,tone:s?"success":"base"})}),e.jsxs(n,{gap:"050",children:[e.jsx(a,{variant:"headingSm",as:"h3",children:o}),s?e.jsxs(a,{variant:"bodySm",tone:"subdued",as:"p",children:[s.name," · BG: ",s.params.background," · Padding: ",Math.round(s.params.padding*100),"% · Shadow: ",s.params.shadow?"On":"Off"]}):e.jsx(a,{variant:"bodySm",tone:"subdued",as:"p",children:"No template assigned"})]})]}),e.jsx(l,{gap:"200",children:f.length>0?e.jsx(C,{size:"slim",onClick:()=>r(o),children:s?"Change":"Assign"}):e.jsx(C,{size:"slim",variant:"primary",onClick:()=>c(o),children:"Create Template"})})]})}),ae=()=>{const o=K(),f=Q(),{addNotification:s}=G(),[r,c]=M.useState(null),[D,d]=M.useState(!1),[u,g]=M.useState(""),{data:$,isLoading:E}=N({queryKey:["template-categories"],queryFn:()=>T.get("/templates/categories")}),{data:F}=N({queryKey:["templates"],queryFn:()=>T.get("/templates")}),q=U({mutationFn:({templateId:t,category:i})=>T.post(`/templates/${t}/set-default`,{category:i}),onSuccess:()=>{f.invalidateQueries({queryKey:["templates"]}),d(!1),c(null),g(""),s({type:"success",title:"Template assigned successfully",autoClose:4e3})},onError:t=>{s({type:"error",title:"Failed to assign template",message:t instanceof Error?t.message:"Unknown error",autoClose:8e3})}}),m=$?.categories||[],x=F?.templates||[],j=$?.mounted||!1,B=x.reduce((t,i)=>{const k=i.category||"uncategorized";return t[k]||(t[k]=[]),t[k].push(i),t},{}),v=x.reduce((t,i)=>(i.isDefault&&i.category&&(t[i.category]=i),t),{}),p=m.filter(t=>v[t]),h=m.filter(t=>!v[t]),R=t=>{c(t),d(!0),g("")},A=t=>{o(`/images?category=${encodeURIComponent(t)}`)},L=()=>{!r||!u||q.mutate({templateId:parseInt(u,10),category:r})},z=[{label:"Select a template...",value:""},...x.map(t=>({label:`${t.name} (${t.params.background}, ${Math.round(t.params.padding*100)}% padding)`,value:String(t.id)}))];return e.jsxs(V,{title:"Category Mapping",subtitle:"Map StyleShoots preset folders to photo templates for automatic processing",primaryAction:{content:"Manage Templates",onAction:()=>o("/images")},children:[e.jsxs(n,{gap:"500",children:[e.jsx(S,{children:e.jsxs(l,{align:"space-between",blockAlign:"center",children:[e.jsxs(l,{gap:"300",blockAlign:"center",children:[e.jsx(I,{background:j?"bg-fill-success-secondary":"bg-fill-critical-secondary",borderRadius:"full",padding:"200",children:e.jsx(w,{source:j?W:H,tone:j?"success":"critical"})}),e.jsxs(n,{gap:"050",children:[e.jsx(a,{variant:"headingSm",as:"h2",children:j?"StyleShoots drive connected":"StyleShoots drive disconnected"}),e.jsxs(a,{variant:"bodySm",tone:"subdued",as:"p",children:[m.length," categories found"]})]})]}),e.jsxs(l,{gap:"200",children:[p.length>0&&e.jsx(y,{tone:"success",children:`${p.length} assigned`}),h.length>0&&e.jsx(y,{tone:"attention",children:`${h.length} need templates`})]})]})}),p.length>0&&e.jsx(b,{children:e.jsx(b.Section,{children:e.jsxs(n,{gap:"300",children:[e.jsxs(l,{gap:"200",blockAlign:"center",children:[e.jsx(a,{variant:"headingMd",as:"h2",children:"Assigned Categories"}),e.jsx(y,{tone:"success",children:String(p.length)})]}),e.jsx(n,{gap:"200",children:p.map(t=>e.jsx(P,{category:t,templates:B[t]||[],defaultTemplate:v[t],onChangeTemplate:R,onCreateTemplate:A},t))})]})})}),h.length>0&&e.jsx(b,{children:e.jsx(b.Section,{children:e.jsxs(n,{gap:"300",children:[e.jsx(l,{gap:"200",align:"space-between",blockAlign:"center",children:e.jsxs(l,{gap:"200",blockAlign:"center",children:[e.jsx(a,{variant:"headingMd",as:"h2",children:"Unassigned Categories"}),e.jsx(y,{tone:"attention",children:`${h.length} need templates`})]})}),e.jsx(n,{gap:"200",children:h.map(t=>e.jsx(P,{category:t,templates:B[t]||[],defaultTemplate:null,onChangeTemplate:R,onCreateTemplate:A},t))})]})})}),m.length===0&&!E&&e.jsx(S,{children:e.jsxs(n,{gap:"300",inlineAlign:"center",children:[e.jsx(I,{background:"bg-fill-secondary",borderRadius:"200",padding:"400",children:e.jsx(w,{source:J})}),e.jsx(a,{variant:"headingMd",as:"h3",alignment:"center",children:"No categories found"}),e.jsx(a,{variant:"bodyMd",tone:"subdued",as:"p",alignment:"center",children:"Connect the StyleShoots drive or create templates with categories to get started."}),e.jsx(C,{variant:"primary",onClick:()=>o("/images"),children:"Manage Templates"})]})})]}),e.jsx(O,{open:D,onClose:()=>{d(!1),c(null),g("")},title:r?`Assign template to "${r}"`:"Assign Template",primaryAction:{content:"Assign Template",onAction:L,disabled:!u,loading:q.isPending},secondaryActions:[{content:"Cancel",onAction:()=>{d(!1),c(null),g("")}}],children:e.jsx(O.Section,{children:e.jsxs(n,{gap:"400",children:[e.jsxs(a,{variant:"bodyMd",as:"p",children:['Select a photo template to use as the default for the "',r,'" category. When new photos arrive, the selected template will be automatically applied.']}),x.length>0?e.jsx(X,{label:"Photo Template",options:z,value:u,onChange:g}):e.jsx(S,{children:e.jsxs(n,{gap:"200",inlineAlign:"center",children:[e.jsx(a,{variant:"bodyMd",as:"p",tone:"subdued",alignment:"center",children:"No templates available. Create a template first."}),e.jsx(C,{variant:"primary",onClick:()=>{d(!1),A(r||"")},children:"Create Template"})]})})]})})})]})};export{ae as default};
