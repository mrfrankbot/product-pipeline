import{r as a,j as e,R as K}from"./vendor-react-DzgxJkbp.js";import{a as W,u as J,b as A}from"./vendor-query-BeqrpgNA.js";import{f}from"./index-DJAOEm-v.js";import{P as B,B as z,T as n,a4 as Y,L as w,C as x,I as l,b,c as D,u as R,a as d,a0 as N,h as G,ag as X,o as P,D as Z,an as ee,V as _,al as te,E as v,e as s}from"./vendor-polaris-o1SQP_xq.js";const ne=i=>{switch(i){case"new":return e.jsx(s,{tone:"info",children:"New"});case"planned":return e.jsx(s,{tone:"attention",children:"Planned"});case"in_progress":return e.jsx(s,{tone:"warning",children:"In Progress"});case"completed":return e.jsx(s,{tone:"success",children:"Completed"});case"declined":return e.jsx(s,{children:"Declined"});default:return e.jsx(s,{children:i})}},se=i=>{switch(i){case"critical":return e.jsx(s,{tone:"critical",children:"Critical"});case"high":return e.jsx(s,{tone:"warning",children:"High"});case"medium":return e.jsx(s,{tone:"info",children:"Medium"});case"low":return e.jsx(s,{children:"Low"});default:return e.jsx(s,{children:i})}},oe=()=>{const i=W(),L=a.useMemo(()=>{if(typeof window>"u")return"anonymous";const t=localStorage.getItem("pp-feature-voter-id");if(t)return t;const o=typeof crypto<"u"&&"randomUUID"in crypto?crypto.randomUUID():`pp-${Date.now()}-${Math.random().toString(36).slice(2,10)}`;return localStorage.setItem("pp-feature-voter-id",o),o},[]),[c,T]=a.useState(()=>{if(typeof window>"u")return new Set;try{const t=localStorage.getItem("pp-feature-votes");return t?new Set(JSON.parse(t)):new Set}catch{return new Set}}),[M,u]=a.useState(!1),[h,q]=a.useState(""),[p,C]=a.useState(""),[j,I]=a.useState("medium"),[m,k]=a.useState(""),[r,E]=a.useState("all"),{data:$,isLoading:O,error:F}=J({queryKey:["features",r],queryFn:()=>{const t=r==="all"?"":`?status=${r}`;return f.get(`/features${t}`)}}),y=A({mutationFn:t=>f.post("/features",t),onSuccess:()=>{u(!1),q(""),C(""),I("medium"),k(""),i.invalidateQueries({queryKey:["features"]})}}),Q=A({mutationFn:t=>f.post(`/features/${t}/vote`,{voterId:L}),onSuccess:(t,o)=>{T(H=>{const S=new Set(H);return S.add(o),typeof window<"u"&&localStorage.setItem("pp-feature-votes",JSON.stringify(Array.from(S))),S}),i.invalidateQueries({queryKey:["features"]})}}),U=a.useCallback(()=>{!h.trim()||!p.trim()||y.mutate({title:h.trim(),description:p.trim(),priority:j,...m.trim()?{requested_by:m.trim()}:{}})},[h,p,j,m,y]),V=[{label:"All",value:"all"},{label:"New",value:"new"},{label:"Planned",value:"planned"},{label:"In Progress",value:"in_progress"},{label:"Completed",value:"completed"},{label:"Declined",value:"declined"}],g=$?.data||[];return F?e.jsx(B,{title:"Feature Requests",children:e.jsx(z,{tone:"critical",title:"Failed to load feature requests",children:e.jsx(n,{as:"p",children:F.message})})}):e.jsxs(B,{title:"Feature Requests",subtitle:"Suggest improvements and track what's coming",primaryAction:{content:"Submit Request",icon:Y,onAction:()=>u(!0)},children:[e.jsxs(w,{children:[e.jsx(w.Section,{children:e.jsx(x,{children:e.jsxs(l,{align:"space-between",blockAlign:"center",wrap:!0,children:[e.jsxs(l,{gap:"300",blockAlign:"center",children:[e.jsx(b,{background:"bg-fill-secondary",borderRadius:"200",padding:"200",children:e.jsx(D,{source:R})}),e.jsxs(d,{gap:"050",children:[e.jsx(n,{variant:"headingSm",as:"h2",children:"Feature requests"}),e.jsxs(n,{variant:"bodySm",tone:"subdued",as:"p",children:[g.length," request",g.length!==1?"s":"",r!=="all"?` with status "${r}"`:""]})]})]}),e.jsx(b,{minWidth:"200px",children:e.jsx(N,{label:"Filter by status",labelHidden:!0,options:V,value:r,onChange:E})})]})})}),e.jsx(w.Section,{children:O?e.jsx(x,{children:e.jsx(G,{lines:8})}):g.length===0?e.jsx(x,{children:e.jsxs(X,{heading:"No feature requests",image:"",children:[e.jsx(n,{as:"p",children:r!=="all"?"No requests with this status. Try a different filter.":"No feature requests yet. Be the first to submit one!"}),e.jsx(P,{onClick:()=>u(!0),variant:"primary",children:"Submit first request"})]})}):e.jsx(x,{children:e.jsx(d,{gap:"0",children:g.map((t,o)=>e.jsxs(K.Fragment,{children:[o>0&&e.jsx(Z,{}),e.jsx(b,{padding:"400",children:e.jsxs(d,{gap:"300",children:[e.jsxs(l,{align:"space-between",blockAlign:"start",wrap:!0,children:[e.jsxs(d,{gap:"100",children:[e.jsx(n,{variant:"headingSm",as:"h3",children:t.title}),e.jsxs(l,{gap:"200",children:[ne(t.status),se(t.priority)]})]}),e.jsxs(d,{gap:"100",inlineAlign:"end",children:[e.jsx(n,{variant:"bodySm",tone:"subdued",as:"span",children:new Date(t.created_at).toLocaleDateString()}),e.jsxs(l,{gap:"200",blockAlign:"center",children:[e.jsxs(l,{gap:"100",blockAlign:"center",children:[e.jsx(D,{source:c.has(t.id)?ee:R,tone:c.has(t.id)?"warning":"subdued"}),e.jsx(n,{variant:"bodySm",fontWeight:"semibold",as:"span",children:t.votes??0})]}),e.jsx(P,{size:"slim",variant:c.has(t.id)?"secondary":"primary",disabled:c.has(t.id),onClick:()=>Q.mutate(t.id),children:c.has(t.id)?"Voted":"Vote"})]})]})]}),e.jsx(n,{variant:"bodyMd",tone:"subdued",as:"p",children:t.description}),t.admin_notes&&e.jsx(b,{background:"bg-fill-secondary",borderRadius:"200",paddingInlineStart:"300",paddingBlockStart:"200",paddingBlockEnd:"200",paddingInlineEnd:"300",children:e.jsxs(d,{gap:"050",children:[e.jsx(n,{variant:"bodySm",fontWeight:"semibold",tone:"subdued",as:"span",children:"Admin notes"}),e.jsx(n,{variant:"bodySm",as:"p",children:t.admin_notes})]})}),e.jsxs(l,{gap:"300",children:[t.requested_by&&e.jsxs(n,{variant:"bodySm",tone:"subdued",as:"span",children:["Requested by ",t.requested_by]}),t.completed_at&&e.jsxs(n,{variant:"bodySm",tone:"subdued",as:"span",children:["· Completed ",new Date(t.completed_at).toLocaleDateString()]})]})]})})]},t.id))})})})]}),e.jsx(_,{open:M,onClose:()=>u(!1),title:"Submit Feature Request",primaryAction:{content:"Submit",onAction:U,loading:y.isPending,disabled:!h.trim()||!p.trim()},secondaryActions:[{content:"Cancel",onAction:()=>u(!1)}],children:e.jsx(_.Section,{children:e.jsxs(te,{children:[e.jsx(v,{label:"Title",value:h,onChange:q,placeholder:"Brief title for your request",autoComplete:"off",requiredIndicator:!0}),e.jsx(v,{label:"Description",value:p,onChange:C,multiline:4,placeholder:"Describe the feature and why it would be useful…",autoComplete:"off",requiredIndicator:!0}),e.jsx(N,{label:"Priority",options:[{label:"Low",value:"low"},{label:"Medium",value:"medium"},{label:"High",value:"high"},{label:"Critical",value:"critical"}],value:j,onChange:I}),e.jsx(v,{label:"Your name (optional)",value:m,onChange:k,autoComplete:"off"})]})})})]})};export{oe as default};
