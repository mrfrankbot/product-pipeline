import{r as c,j as e,u as z}from"./vendor-react-DzgxJkbp.js";import{a as L,u as D,b as I}from"./vendor-query-BeqrpgNA.js";import{f as A}from"./index-DJAOEm-v.js";import{C as w,x as E,a as S,B as Q,T as n,D as T,U as $,I as j,e as y,E as G,o as _,P as H,$ as W,L as k,b as F,ao as O,ap as V,ag as U,aq as Y,y as R,ar as J,V as B}from"./vendor-polaris-o1SQP_xq.js";const X=()=>{const a=L(),[u,o]=c.useState(""),[v,h]=c.useState({autoPublishNoPhotos:!1,autoPublishNoDescription:!1}),[p,i]=c.useState([]),[f,g]=c.useState(!1),{data:d,isLoading:x}=D({queryKey:["draft-settings"],queryFn:()=>A.get("/drafts/settings")});c.useEffect(()=>{d&&(h(d.global),i(d.perType),g(!1))},[d]);const P=I({mutationFn:t=>A.put("/drafts/settings",t),onSuccess:()=>{a.invalidateQueries({queryKey:["draft-settings"]}),g(!1)}}),b=t=>l=>{h(r=>({...r,[t]:l})),g(!0)},C=t=>{i(l=>l.map(r=>r.product_type===t?{...r,enabled:!r.enabled}:r)),g(!0)},q=()=>{const t=u.trim();t&&(p.some(l=>l.product_type===t)||(i(l=>[...l,{product_type:t,enabled:!0}]),o(""),g(!0)))},N=()=>{P.mutate({perType:p,global:v})};return x?e.jsx(w,{children:e.jsx("div",{style:{textAlign:"center",padding:"2rem"},children:e.jsx(E,{size:"large"})})}):e.jsxs(S,{gap:"400",children:[e.jsx(Q,{tone:"warning",children:e.jsxs("p",{children:[e.jsx("strong",{children:"Active products with existing content always require manual review."})," ","Auto-publish only applies to products that have ",e.jsx("em",{children:"no"})," existing photos or descriptions on Shopify. This ensures live product data is never overwritten without human approval."]})}),e.jsx(w,{children:e.jsxs(S,{gap:"400",children:[e.jsx(n,{variant:"headingMd",as:"h2",children:"Global Auto-Publish Rules"}),e.jsx(n,{variant:"bodySm",as:"p",tone:"subdued",children:"These rules determine when processed content is automatically published without requiring manual review."}),e.jsx(T,{}),e.jsx($,{label:"Auto-publish when product has no existing photos",helpText:"When enabled, products with no Shopify photos will have draft images published automatically.",checked:v.autoPublishNoPhotos,onChange:b("autoPublishNoPhotos")}),e.jsx($,{label:"Auto-publish when product has no existing description",helpText:"When enabled, products with no Shopify description will have AI descriptions published automatically.",checked:v.autoPublishNoDescription,onChange:b("autoPublishNoDescription")})]})}),e.jsx(w,{children:e.jsxs(S,{gap:"400",children:[e.jsx(n,{variant:"headingMd",as:"h2",children:"Per Product Type Settings"}),e.jsx(n,{variant:"bodySm",as:"p",tone:"subdued",children:"Enable auto-publish for specific product types. Only products with no existing content will be auto-published."}),e.jsx(T,{}),p.length===0?e.jsx(n,{as:"p",tone:"subdued",children:"No product type rules configured. Add one below."}):e.jsx(S,{gap:"200",children:p.map(t=>e.jsxs(j,{align:"space-between",blockAlign:"center",children:[e.jsxs(j,{gap:"200",blockAlign:"center",children:[e.jsx($,{label:"",checked:t.enabled,onChange:()=>C(t.product_type)}),e.jsx(n,{variant:"bodyMd",as:"span",children:t.product_type})]}),e.jsx(y,{tone:t.enabled?"success":void 0,children:t.enabled?"Auto-publish":"Manual review"})]},t.product_type))}),e.jsx(T,{}),e.jsxs(j,{gap:"200",blockAlign:"end",children:[e.jsx("div",{style:{flex:1},children:e.jsx(G,{label:"Add product type",labelHidden:!0,value:u,onChange:o,placeholder:"e.g. Camera, Lens, Flash",autoComplete:"off"})}),e.jsx(_,{onClick:q,disabled:!u.trim(),children:"Add"})]})]})}),f&&e.jsx("div",{style:{position:"sticky",bottom:0,padding:"1rem 0"},children:e.jsx(Q,{tone:"info",children:e.jsxs(j,{align:"space-between",blockAlign:"center",children:[e.jsx(n,{as:"span",children:"You have unsaved changes."}),e.jsx(_,{variant:"primary",onClick:N,loading:P.isPending,children:"Save Settings"})]})})})]})},Z=a=>{switch(a){case"pending":return e.jsx(y,{tone:"attention",children:"Pending"});case"approved":return e.jsx(y,{tone:"success",children:"Approved"});case"rejected":return e.jsx(y,{tone:"critical",children:"Rejected"});case"partial":return e.jsx(y,{tone:"warning",children:"Partial"});default:return e.jsx(y,{children:a})}},ee=a=>new Date(a*1e3).toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),te=(a,u=120)=>{const o=a.replace(/<[^>]*>/g,"").replace(/&[^;]+;/g," ");return o.length>u?o.substring(0,u)+"…":o},le=()=>{const a=L(),u=z(),[o,v]=c.useState(0),[h,p]=c.useState(["pending"]),[i,f]=c.useState(0),[g,d]=c.useState(!1),x=20,P=[{id:"queue",content:"Review Queue"},{id:"settings",content:"Auto-Publish Settings"}],b=h[0]||"pending",{data:C,isLoading:q}=D({queryKey:["drafts",b,i],queryFn:()=>A.get(`/drafts?status=${b}&limit=${x}&offset=${i*x}`),refetchInterval:1e4}),{data:N}=D({queryKey:["drafts-count"],queryFn:()=>A.get("/drafts/count"),refetchInterval:1e4}),t=I({mutationFn:()=>A.post("/drafts/approve-all",{photos:!0,description:!0,confirm:!0}),onSuccess:()=>{a.invalidateQueries({queryKey:["drafts"]}),a.invalidateQueries({queryKey:["drafts-count"]}),d(!1)}}),l=C?.data||[],r=C?.total||0,m=N?.count||0;return e.jsxs(H,{title:"Review Queue",subtitle:`${m} drafts awaiting review`,primaryAction:m>0?{content:`Approve All (${m})`,onAction:()=>d(!0)}:void 0,children:[e.jsx(W,{tabs:P,selected:o,onSelect:v,children:o===0?e.jsx(k,{children:e.jsxs(k.Section,{children:[e.jsxs(w,{padding:"0",children:[e.jsx(F,{padding:"400",paddingBlockEnd:"0",children:e.jsx(O,{queryValue:"",onQueryChange:()=>{},onQueryClear:()=>{},onClearAll:()=>p(["pending"]),filters:[{key:"status",label:"Status",filter:e.jsx(V,{title:"Status",titleHidden:!0,choices:[{label:"Pending",value:"pending"},{label:"Approved",value:"approved"},{label:"Rejected",value:"rejected"},{label:"Partial",value:"partial"},{label:"All",value:"all"}],selected:h,onChange:s=>{p(s),f(0)}}),shortcut:!0}],appliedFilters:h[0]!=="pending"?[{key:"status",label:`Status: ${h[0]}`,onRemove:()=>p(["pending"])}]:[],hideQueryField:!0})}),e.jsx(T,{}),q?e.jsx(F,{padding:"500",children:e.jsx(j,{align:"center",children:e.jsx(E,{size:"large"})})}):l.length===0?e.jsx(F,{padding:"500",children:e.jsx(U,{heading:"No drafts found",image:"",children:e.jsx(n,{as:"p",variant:"bodyMd",children:b==="pending"?"All caught up! No drafts awaiting review.":`No ${b} drafts.`})})}):e.jsx(Y,{resourceName:{singular:"draft",plural:"drafts"},items:l,renderItem:s=>{const M=s.draftImages?.[0],K=M&&M.startsWith("http")?e.jsx(R,{source:M,alt:s.draft_title||"",size:"medium"}):e.jsx(R,{source:"",alt:"",size:"medium"});return e.jsx(J,{id:String(s.id),media:K,onClick:()=>u(`/review/${s.id}`),accessibilityLabel:`Review draft ${s.draft_title||s.shopify_product_id}`,children:e.jsxs(j,{align:"space-between",blockAlign:"center",children:[e.jsxs(S,{gap:"100",children:[e.jsx(n,{variant:"bodyMd",fontWeight:"bold",as:"span",children:s.draft_title||s.original_title||`Product #${s.shopify_product_id}`}),e.jsxs(n,{variant:"bodySm",as:"span",tone:"subdued",children:[s.draftImages.length," photos",s.draft_description?` · ${te(s.draft_description,80)}`:""]}),e.jsx(n,{variant:"bodySm",as:"span",tone:"subdued",children:ee(s.created_at)})]}),Z(s.status)]})})}})]}),r>x&&e.jsx(w,{children:e.jsxs(j,{align:"center",blockAlign:"center",gap:"300",children:[e.jsx(_,{disabled:i===0,onClick:()=>f(i-1),children:"Previous"}),e.jsxs(n,{variant:"bodySm",as:"span",tone:"subdued",children:["Page ",i+1," of ",Math.ceil(r/x)]}),e.jsx(_,{disabled:(i+1)*x>=r,onClick:()=>f(i+1),children:"Next"})]})})]})}):e.jsx(k,{children:e.jsx(k.Section,{children:e.jsx(X,{})})})}),e.jsx(B,{open:g,onClose:()=>d(!1),title:"Bulk Approve All Pending Drafts",primaryAction:{content:`Approve All ${m} Drafts`,onAction:()=>t.mutate(),loading:t.isPending},secondaryActions:[{content:"Cancel",onAction:()=>d(!1)}],children:e.jsx(B.Section,{children:e.jsx(Q,{tone:"warning",children:e.jsxs(n,{as:"p",children:["This will approve ",e.jsx("strong",{children:m})," pending drafts and push their content to Shopify. This action cannot be undone."]})})})})]})};export{le as default};
