import{r,j as e}from"./vendor-react-DzgxJkbp.js";import{u as H}from"./vendor-query-BeqrpgNA.js";import{C as D,b as $,T as n,a as h,I as c,o as F,B as I,e as q,D as R,V as z,E as L,R as G}from"./vendor-polaris-o1SQP_xq.js";import{g as f,T as J}from"./index-DJAOEm-v.js";const V=[["path",{d:"M17 3a2 2 0 0 1 2 2v15a1 1 0 0 1-1.496.868l-4.512-2.578a2 2 0 0 0-1.984 0l-4.512 2.578A1 1 0 0 1 5 20V5a2 2 0 0 1 2-2z",key:"oz39mx"}]],K=f("bookmark",V);const Q=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]],U=f("image",Q);const X=[["path",{d:"M12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83z",key:"zw3jo"}],["path",{d:"M2 12a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 12",key:"1wduqc"}],["path",{d:"M2 17a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 17",key:"kqbvx6"}]],Y=f("layers",X);const Z=[["path",{d:"M12 22a1 1 0 0 1 0-20 10 9 0 0 1 10 9 5 5 0 0 1-5 5h-2.25a1.75 1.75 0 0 0-1.4 2.8l.3.4a1.75 1.75 0 0 1-1.4 2.8z",key:"e79jfc"}],["circle",{cx:"13.5",cy:"6.5",r:".5",fill:"currentColor",key:"1okk4w"}],["circle",{cx:"17.5",cy:"10.5",r:".5",fill:"currentColor",key:"f64h9f"}],["circle",{cx:"6.5",cy:"12.5",r:".5",fill:"currentColor",key:"qy21gx"}],["circle",{cx:"8.5",cy:"7.5",r:".5",fill:"currentColor",key:"fotxhn"}]],ee=f("palette",Z);const ae=[["path",{d:"M13 21h8",key:"1jsn5i"}],["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]],se=f("pen-line",ae);const te=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],ne=f("plus",te);const oe=[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]],re=f("star",oe),ie=[{hex:"#FFFFFF",label:"White"},{hex:"#F5F5F5",label:"Light Gray"},{hex:"#E0E0E0",label:"Gray"},{hex:"#000000",label:"Black"},{hex:"#E8F0FE",label:"Light Blue"},{hex:"#FFF9E6",label:"Cream"}],_=({params:a})=>e.jsx("div",{style:{width:80,height:80,backgroundColor:a.background,borderRadius:8,border:"1px solid #e5e7eb",display:"flex",alignItems:"center",justifyContent:"center",position:"relative",overflow:"hidden"},children:e.jsx("div",{style:{width:`${Math.max(20,80-a.padding*160)}px`,height:`${Math.max(20,80-a.padding*160)}px`,backgroundColor:"#9ca3af",borderRadius:4,boxShadow:a.shadow?"0 4px 8px rgba(0,0,0,0.2)":"none"}})}),le=({template:a,productId:i,onEdit:j,onDelete:m,onApply:w,onSetDefault:S,applying:g})=>e.jsx(D,{padding:"300",children:e.jsxs(h,{gap:"300",children:[e.jsx(c,{align:"space-between",blockAlign:"start",children:e.jsxs(c,{gap:"300",blockAlign:"center",children:[e.jsx(_,{params:a.params}),e.jsxs(h,{gap:"100",children:[e.jsxs(c,{gap:"200",blockAlign:"center",children:[e.jsx(n,{variant:"headingSm",as:"h3",children:a.name}),a.isDefault&&e.jsx(q,{tone:"success",children:"⭐ Default"})]}),a.category&&e.jsxs(n,{variant:"bodySm",tone:"subdued",as:"p",children:["Category: ",a.category]}),e.jsxs(c,{gap:"200",children:[e.jsxs(n,{variant:"bodySm",tone:"subdued",as:"span",children:["BG: ",a.params.background]}),e.jsxs(n,{variant:"bodySm",tone:"subdued",as:"span",children:["Padding: ",Math.round(a.params.padding*100),"%"]}),e.jsxs(n,{variant:"bodySm",tone:"subdued",as:"span",children:["Shadow: ",a.params.shadow?"On":"Off"]})]})]})]})}),e.jsx(R,{}),e.jsxs(c,{gap:"200",children:[i&&e.jsx(F,{size:"slim",variant:"primary",loading:g===a.id,onClick:()=>w(a),icon:e.jsx(U,{size:14}),children:"Apply"}),e.jsx(F,{size:"slim",onClick:()=>j(a),icon:e.jsx(se,{size:14}),children:"Edit"}),!a.isDefault&&a.category&&e.jsx(F,{size:"slim",onClick:()=>S(a),icon:e.jsx(re,{size:14}),children:"Set Default"}),e.jsx(F,{size:"slim",tone:"critical",onClick:()=>m(a.id),icon:e.jsx(J,{size:14}),children:"Delete"})]})]})}),ce=({open:a,editingTemplate:i,onClose:j,onSave:m,saving:w,initialCategory:S})=>{const[g,k]=r.useState(""),[l,v]=r.useState(""),[d,x]=r.useState("#FFFFFF"),[b,C]=r.useState(10),[p,T]=r.useState(!0),[y,u]=r.useState(!1),{data:M}=H({queryKey:["template-categories"],queryFn:async()=>{const o=await fetch("/api/templates/categories");if(!o.ok)throw new Error(`HTTP ${o.status}`);return o.json()}}),E=M?.categories||[];r.useEffect(()=>{i?(k(i.name),v(i.category??""),x(i.params.background),C(Math.round(i.params.padding*100)),T(i.params.shadow),u(i.isDefault)):(k(""),v(S??""),x("#FFFFFF"),C(10),T(!0),u(!1))},[i,a,S]);const P=()=>{m({name:g,category:l,params:{background:d,padding:b/100,shadow:p},isDefault:y})};return e.jsx(z,{open:a,onClose:j,title:i?`Edit Template: ${i.name}`:"Create New Template",primaryAction:{content:i?"Save Changes":"Create Template",onAction:P,loading:w,disabled:!g.trim()},secondaryActions:[{content:"Cancel",onAction:j}],children:e.jsx(z.Section,{children:e.jsxs(h,{gap:"400",children:[e.jsx(L,{label:"Template Name",value:g,onChange:k,autoComplete:"off",placeholder:"e.g. Small Lenses"}),e.jsx(L,{label:"Category (StyleShoots Preset)",value:l,onChange:v,autoComplete:"off",placeholder:"Select or type a category...",helpText:E.length>0?`Available categories: ${E.join(", ")}. Maps to a StyleShoots preset folder name for auto-apply.`:"Maps to a StyleShoots preset folder name for auto-apply"}),e.jsx(R,{}),e.jsxs(h,{gap:"200",children:[e.jsxs(c,{gap:"100",blockAlign:"center",children:[e.jsx(ee,{size:16,color:"#6b7280"}),e.jsx(n,{variant:"bodyMd",fontWeight:"semibold",as:"span",children:"Background Color"})]}),e.jsx(c,{gap:"200",wrap:!0,children:ie.map(o=>e.jsx("button",{onClick:()=>x(o.hex),title:o.label,style:{width:32,height:32,borderRadius:6,border:d===o.hex?"2px solid #2563eb":"2px solid #e5e7eb",backgroundColor:o.hex,cursor:"pointer",padding:0,position:"relative"},children:d===o.hex&&e.jsx("span",{style:{position:"absolute",inset:0,display:"flex",alignItems:"center",justifyContent:"center",color:o.hex==="#000000"?"#fff":"#2563eb",fontWeight:700,fontSize:14},children:"✓"})},o.hex))}),e.jsxs(n,{variant:"bodySm",tone:"subdued",as:"p",children:["Selected: ",d]})]}),e.jsxs(h,{gap:"200",children:[e.jsxs(c,{gap:"100",blockAlign:"center",children:[e.jsx(Y,{size:16,color:"#6b7280"}),e.jsx(n,{variant:"bodyMd",fontWeight:"semibold",as:"span",children:"Padding"}),e.jsxs(n,{variant:"bodySm",tone:"subdued",as:"span",children:[b,"%"]})]}),e.jsx(G,{label:"",value:b,min:0,max:50,step:1,onChange:o=>C(typeof o=="number"?o:o[0]),output:!0})]}),e.jsxs(c,{align:"space-between",blockAlign:"center",children:[e.jsx(n,{variant:"bodyMd",fontWeight:"semibold",as:"span",children:"Drop Shadow"}),e.jsx("button",{onClick:()=>T(!p),style:{position:"relative",width:44,height:24,borderRadius:12,border:"none",backgroundColor:p?"#2563eb":"#d1d5db",cursor:"pointer",transition:"background-color 200ms",padding:0},children:e.jsx("span",{style:{position:"absolute",top:2,left:p?22:2,width:20,height:20,borderRadius:"50%",backgroundColor:"#fff",transition:"left 200ms",boxShadow:"0 1px 3px rgba(0,0,0,0.2)"}})})]}),l&&e.jsxs(c,{align:"space-between",blockAlign:"center",children:[e.jsxs(h,{gap:"050",children:[e.jsx(n,{variant:"bodyMd",fontWeight:"semibold",as:"span",children:"Set as Default"}),e.jsxs(n,{variant:"bodySm",tone:"subdued",as:"p",children:['Auto-apply when photos arrive in "',l,'"']})]}),e.jsx("button",{onClick:()=>u(!y),style:{position:"relative",width:44,height:24,borderRadius:12,border:"none",backgroundColor:y?"#f59e0b":"#d1d5db",cursor:"pointer",transition:"background-color 200ms",padding:0},children:e.jsx("span",{style:{position:"absolute",top:2,left:y?22:2,width:20,height:20,borderRadius:"50%",backgroundColor:"#fff",transition:"left 200ms",boxShadow:"0 1px 3px rgba(0,0,0,0.2)"}})})]}),e.jsx($,{padding:"300",background:"bg-surface-secondary",borderRadius:"200",children:e.jsxs(c,{gap:"300",blockAlign:"center",children:[e.jsx(_,{params:{background:d,padding:b/100,shadow:p}}),e.jsxs(h,{gap:"100",children:[e.jsx(n,{variant:"bodySm",fontWeight:"semibold",as:"span",children:"Preview"}),e.jsxs(n,{variant:"bodySm",tone:"subdued",as:"p",children:["Background: ",d," · Padding: ",b,"% · Shadow: ",p?"On":"Off"]})]})]})})]})})})},ge=({productId:a,onApplied:i,initialCategory:j})=>{const[m,w]=r.useState([]),[S,g]=r.useState(!0),[k,l]=r.useState(null),[v,d]=r.useState(!1),[x,b]=r.useState(null),[C,p]=r.useState(!1),[T,y]=r.useState(null),u=r.useCallback(async()=>{try{g(!0);const s=await fetch("/api/templates");if(!s.ok)throw new Error(`HTTP ${s.status}`);const t=await s.json();w(t.templates||[]),l(null)}catch(s){l(String(s))}finally{g(!1)}},[]);r.useEffect(()=>{u()},[u]);const M=()=>{b(null),d(!0)},E=s=>{b(s),d(!0)},P=async s=>{p(!0);try{const t=x?`/api/templates/${x.id}`:"/api/templates",A=await fetch(t,{method:x?"PUT":"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:s.name,category:s.category||null,params:s.params,isDefault:s.isDefault})});if(!A.ok){const W=await A.json();throw new Error(W.error||`HTTP ${A.status}`)}d(!1),await u()}catch(t){l(String(t))}finally{p(!1)}},o=async s=>{if(confirm("Delete this template?"))try{const t=await fetch(`/api/templates/${s}`,{method:"DELETE"});if(!t.ok)throw new Error(`HTTP ${t.status}`);await u()}catch(t){l(String(t))}},N=async s=>{if(a){y(s.id);try{const t=await fetch(`/api/templates/${s.id}/apply/${a}`,{method:"POST"});if(!t.ok)throw new Error(`HTTP ${t.status}`);const B=await t.json();i?.(s.id),l(null)}catch(t){l(String(t))}finally{y(null)}}},O=async s=>{if(s.category)try{const t=await fetch(`/api/templates/${s.id}/set-default`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({category:s.category})});if(!t.ok)throw new Error(`HTTP ${t.status}`);await u()}catch(t){l(String(t))}};return S?e.jsx(D,{children:e.jsx($,{padding:"400",children:e.jsx(n,{tone:"subdued",as:"p",children:"Loading templates…"})})}):e.jsxs(e.Fragment,{children:[e.jsx(D,{children:e.jsxs(h,{gap:"400",children:[e.jsxs(c,{align:"space-between",blockAlign:"center",children:[e.jsxs(h,{gap:"050",children:[e.jsx(n,{variant:"headingMd",as:"h2",children:"Photo Templates"}),e.jsx(n,{variant:"bodySm",tone:"subdued",as:"p",children:"Reusable PhotoRoom settings for consistent photo processing"})]}),e.jsx(F,{variant:"primary",onClick:M,icon:e.jsx(ne,{size:16}),children:"New Template"})]}),k&&e.jsx(I,{tone:"critical",onDismiss:()=>l(null),children:e.jsx("p",{children:k})}),m.length===0?e.jsx($,{padding:"400",children:e.jsxs(h,{gap:"200",inlineAlign:"center",children:[e.jsx(K,{size:48,color:"#9ca3af"}),e.jsx(n,{tone:"subdued",as:"p",alignment:"center",children:"No templates yet. Create one to save reusable photo settings."}),e.jsx(n,{variant:"bodySm",tone:"subdued",as:"p",alignment:"center",children:'Or use the chat: "Save current settings as Small Lenses template"'})]})}):e.jsx(h,{gap:"300",children:m.map(s=>e.jsx(le,{template:s,productId:a,onEdit:E,onDelete:o,onApply:N,onSetDefault:O,applying:T},s.id))})]})}),e.jsx(ce,{open:v,editingTemplate:x,onClose:()=>d(!1),onSave:P,saving:C,initialCategory:j})]})};export{U as I,Y as L,ee as P,ge as T};
